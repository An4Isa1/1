<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Pensum Economía UMNG</title>
  <style>
    body {
      font-family: "Times New Roman", serif;
      background: #f9f9f9;
      margin: 20px;
    }
    h1, h2 {
      font-family: Georgia, serif;
      font-style: italic;
      text-align: center;
    }
    .contenedor-semestres {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      margin-top: 30px;
    }
    .semestre {
      background-color: #e3e3e3;
      border-radius: 10px;
      width: 280px;
      padding: 15px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    .semestre-1 { background-color: #d1e7dd; }
    .semestre-2 { background-color: #ffeeba; }
    .semestre-3 { background-color: #f8d7da; }
    .semestre-4 { background-color: #cfe2ff; }
    .semestre-5 { background-color: #e2e3e5; }
    .semestre-6 { background-color: #d4edda; }
    .semestre-7 { background-color: #fff3cd; }
    .semestre-8 { background-color: #f5c6cb; }
    .semestre-9 { background-color: #b8daff; }
    .materia {
      background: white;
      margin: 8px 0;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      position: relative;
    }
    .materia.bloqueada {
      background: #ccc;
      color: #666;
      cursor: not-allowed;
    }
    .materia.aprobada {
      background-color: #a8e6a3;
      text-decoration: line-through;
      cursor: default;
    }
    .formulario {
      display: none;
      margin-top: 8px;
    }
    .formulario input {
      display: block;
      width: 95%;
      margin: 6px 0;
      padding: 6px;
      font-size: 14px;
    }
    .formulario button {
      padding: 6px 12px;
      cursor: pointer;
      background-color: #2980b9;
      color: white;
      border: none;
      border-radius: 5px;
    }
  </style>
</head>
<body>

  <h1>Pensum Economía</h1>
  <h2>UMNG</h2>

  <div class="contenedor-semestres" id="contenedor"></div>

  <script>
    const materias = {
      1: [
        { nombre: "Economía I", requisitos: [] },
        { nombre: "Matemáticas I", requisitos: [] },
        { nombre: "Historia Económica General", requisitos: [] }
      ],
      2: [
        { nombre: "Economía II", requisitos: ["Economía I"] },
        { nombre: "Matemáticas II", requisitos: ["Matemáticas I"] }
      ],
      3: [
        { nombre: "Microeconomía I", requisitos: ["Economía II", "Matemáticas II"] },
        { nombre: "Contabilidad General", requisitos: [] }
      ],
    };

    const estado = JSON.parse(localStorage.getItem("estadoPensum")) || {};

    function estaDesbloqueada(materia) {
      return materia.requisitos.every(req => estado[req]?.aprobada);
    }

    function guardarEstado() {
      localStorage.setItem("estadoPensum", JSON.stringify(estado));
    }

    function calcularPromedio(n1, n2, n3) {
      return ((n1 + n2 + n3) / 3).toFixed(2);
    }

    function crearMateria(materia) {
      const div = document.createElement("div");
      div.classList.add("materia");

      const desbloqueada = estaDesbloqueada(materia);

      if (!desbloqueada) {
        div.classList.add("bloqueada");
        div.textContent = materia.nombre + " (Requisitos no cumplidos)";
        return div;
      }

      if (estado[materia.nombre]?.aprobada) {
        div.classList.add("aprobada");
        div.textContent = `${materia.nombre} (Aprobada) - Profesor: ${estado[materia.nombre].profesor} - Promedio: ${estado[materia.nombre].promedio}`;
        return div;
      }

      div.textContent = materia.nombre;

      const formulario = document.createElement("div");
      formulario.classList.add("formulario");

      formulario.innerHTML = `
        <input type="text" name="profesor" placeholder="Nombre del profesor" />
        <input type="number" name="nota1" min="0" max="5" step="0.1" placeholder="Nota corte 1" />
        <input type="number" name="nota2" min="0" max="5" step="0.1" placeholder="Nota corte 2" />
        <input type="number" name="nota3" min="0" max="5" step="0.1" placeholder="Nota corte 3" />
        <button>Guardar</button>
      `;

      formulario.querySelector("button").addEventListener("click", (e) => {
        e.stopPropagation();

        const profesor = formulario.querySelector('input[name="profesor"]').value.trim();
        const n1 = parseFloat(formulario.querySelector('input[name="nota1"]').value);
        const n2 = parseFloat(formulario.querySelector('input[name="nota2"]').value);
        const n3 = parseFloat(formulario.querySelector('input[name="nota3"]').value);

        if (!profesor || isNaN(n1) || isNaN(n2) || isNaN(n3)) {
          alert("Por favor completa todos los campos correctamente.");
          return;
        }

        const promedio = calcularPromedio(n1, n2, n3);

        estado[materia.nombre] = {
          profesor,
          nota1: n1,
          nota2: n2,
          nota3: n3,
          promedio,
          aprobada: promedio >= 3.0
        };

        guardarEstado();

        // Actualizar el contenido de la materia sin recargar página
        div.classList.add("aprobada");
        div.textContent = `${materia.nombre} (Aprobada) - Profesor: ${profesor} - Promedio: ${promedio}`;
      });

      div.appendChild(formulario);

      div.addEventListener("click", () => {
        if (formulario.style.display === "block") {
          formulario.style.display = "none";
        } else {
          formulario.style.display = "block";
        }
      });

      return div;
    }

    function renderizar() {
      const contenedor = document.getElementById("contenedor");
      contenedor.innerHTML = "";

      for (const semestre in materias) {
        const divSemestre = document.createElement("div");
        divSemestre.classList.add("semestre", `semestre-${semestre}`);
        divSemestre.innerHTML = `<h3>Semestre ${semestre}</h3>`;

        materias[semestre].forEach(materia => {
          const materiaDiv = crearMateria(materia);
          divSemestre.appendChild(materiaDiv);
        });

        contenedor.appendChild(divSemestre);
      }
    }

    renderizar();
  </script>

</body>
</html>
